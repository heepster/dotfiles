- name: Install Terraform Manager
  become: no
  shell: |
    git clone https://github.com/tfutils/tfenv.git /home/{{ ansible_user_id }}/.tfenv
  args:
    creates: /home/{{ ansible_user_id }}/.tfenv

- name: Symlink Terraform Manager to /usr/local/bin
  file: 
    src: /home/{{ ansible_user_id }}/.tfenv/bin/{{ item.src }}
    dest: /usr/local/bin/{{ item.dest }}
    state: link
  loop:
    - { src: 'tfenv', dest: 'tfenv' }
    - { src: 'terraform', dest: 'terraform' }

- name: Install latest version of terraform
  become: no
  shell: |
    /home/{{ ansible_user_id}}/.tfenv/bin/tfenv install
  args:
    creates: /home/{{ ansible_user_id}}/.tfenv/versions/
